THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. 


The TGUP File Manager (TGFM) is a java applet for managing files across the distributed file systems of the TeraGrid.  The TGFM is written against the java 1.5+ jre and runs in the TGUP as a portlet.  The TGFM handles authentication and authorization internally by the leveraging the user's TG credentials obtained from the TGUP.  Thus, if a user did not login to the portal, they are not able to use the TGFM.  One note of interest is that the TGFM does not extend the life of the user's TGUP credential.  Instead, the TGFM leverages the existing credential to maintain the session lifetime management imposed by the TGUP.

Supporting the TGFM is a streamlined servlet architecture providing file transfer logging and event notifications.  The servlet is written against the java 1.5 JRE and hosted in an Apache XML-RPC server.  A MySQL server holds the database used to persist the logs and events registered by the servlet.  Both servers are run on a development machine here at TACC: derrick.tacc.utexas.edu.  The XML-RPC server runs in standalone mode on port 9001.  The MySQL server runs on port 3307.  

The database used by the servlet is named 'sggc'. There are 3 tables in the db: Notifications, Transfers and Variables.  Only the Notifications and Transfers tables are currently used.  I've included an SQL file of the database for loading into PostgreSQL.  I've included a diagram of how the TGFM interacts with the XML-RPC server and how the server interacts with the database.  The XML-RPC server consists of 3 interfaces.  One for resource information, one for registering and updating file transfers, and one for notification registration and deregistration.  The resource interface is straight forward.  When the user first starts the TGFM applet, it calls the resource interface to request a list of available TG resources for the user matching the user's DN and username.  This list is passed back to the client and is used to populate the systems drop down combo box.  In order to provide the user with a better experience, by default, users will only see the resources from the TGUP -> My TeraGrid -> Accounts portlet in the system drop down box.  Further, resources are broken down by category: Compute, Viz, and Storage based on a static mapping done in the servlet.

The other two interfaces are slightly more complicated and utilize the MySQL db.  When the TGFM starts a file transfer, the transfer is registered with the logging servlet.  The servlet inserts a record into the Transfers table and returns a unique integer identifier to the TGFM.  The client has an option of registering for notifications upon file start, stop, and error.  The notification servlet supports IM, SMS, TXT and EMAIL notifications.  Due to the lack of cell phone numbers in the TGCDB, the only current option displayed in the TGFM is EMAIL.  The TGFM has a preference dialog that allows the user to specify a global notification mechanism for all their file transfers.  Upon loading, the default value is NONE, meaning no notifications will be sent.  In this situation, when a file transfer is registered with the logging servlet, no notification event will be registered and thus inserted into the Notifications table.  However, if the default notification mechanism is set to EMAIL, or an email notification is requested for a particular file transfer, then a notification registration call will be made to the notification servlet and an email will be sent to the user's TGCDB specified email address when an event occurs.  Notifications can be added (or removed) for any active file transfer listed in the TGFM history panel by right clicking on a file transfer and selecting Notify -> Email (or Clear).

All file transfers are directly managed by the TGFM as are all file transfer statuses and events.  If the user requests a third party transfer, the TGFM initiates the transfer and monitors its progress.  As a result, all direct transfers still running when the TGFM closes will be cut off.  All third party transfers still running when the TGFM closes will continue, but will not be updated by the logging service.  Events sent from the TGFM to the logging servlet are the triggers for the notification service.  Thus, no notifications will be sent to the user for file transfers once the TGFM closes.  Note that this does not say anything about expired credentials.  If a user's credentials expire during a long running file transfer, the file transfer will still finish and the user will still be notified provided they leave the TGFM open.

File transfers are implemented using an adaptor pattern.  A generic FTP interface is available to use in the TGFM model layer while the controller layer instantiates either GridFTP or local java.io.File adaptors to carry out the requests.  Such an approach implies the usual dependencies such as the remote servers must have GridFTP servers running, the users much have valid credentials mapped to the accounts on those machines, etc.  This being TG, those are generally well defined solutions.  One well known feature of the FTP protocol is that it does not support environmental variables.  Thus, the user cannot specify a 'cd $SCRATCH'.  To work around this problem, the TGFM leverages the GSI-SSHTERM library to retrieve the remote environment of a system once a GridFTP session is initialized.  This works great when running the TGFM as a standalone application, but is broken when running as an applet.  As a result, shortcut buttons are currently unavailable in the TGFM.





